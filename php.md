# PHPコーディング規約

ここではWebアプリケーション開発の基本となるPHPコーディング規約を示します。基本的にはCakePHPの[コーディング規約](http://book.cakephp.org/2.0/ja/contributing/cakephp-coding-conventions.html)に準拠するような形で作成されています。

ただし、CakePHP以外のフレームワークなどを使用する際には、別の規約を適用することもあります。

## インデント

インデントには単一のタブコードを使用します。

```php
$hoge = 'hoge';
$piyo = 'piyo';
if ($hoge) {
	echo $hoge;
	if ($piyo) {
		echo $piyo;
	}
}
```

## 制御構造

制御構造は例えば “if“、”for“、”foreach“、”while“、”switch“などです。

```php
if ((expr_1) || (expr_2)) {
    // action_1;
} else if (!(expr_3) && (expr_4)) {
    // action_2;
} else {
    // default_action;
}
```

- 制御構造では1個の空白が最初の丸括弧の前に、1個の空白が最後の丸括弧と開き中括弧の間にある必要があります。
- 制御構造では、必要でなくとも常に中括弧を使います。 これはコードの可読性を高め、論理エラーが稀になります。
- 開き中括弧は制御構造と同じ行に置かれる必要があります。 閉じ中括弧は新しい行に置かれ、制御構造と同じレベルのインデントがされている必要があります。 中括弧内に含まれているステートメントは新しい行で始まり、その中に含まれるコードは、新しいレベルのインデントが付けられる必要があります。
- インラインの代入は、制御構造の中で使用するべきではありません。
- elseif は続けて書かず、else if と空白を開けるようにしてください。

### if分の中括弧 省略禁止

上記にも書かれていますが、中括弧の省略は認められません。例えば以下の様なコードは禁止されています。

```php
if ($hoge)
	// action
```

これは、コードを改修していく過程の中で思わぬバグの原因になります。かならず中括弧で囲んでブロックとして認識できるようにしてください。

### 三項演算子

1行が長すぎず、ネストされていない三項演算子は使っても大丈夫です。目安として通常のエディタで折り返すような条件式の場合は、if else を使用してください。

## 関数の呼び出し

関数は、関数の名前と開き括弧の間に空白を入れて呼び出してはいけません。 関数呼び出しの引数各々に対して単一の空白がある必要があります。

```php
$var = foo($bar, $bar2, $bar3);
```

上記をご覧の通り、イコール記号(=)の両サイドには単一の空白がある必要があります。

## メソッドの定義

メソッドは、必ずなんらかのデータを返すように作ってください。データとして何もない場合は、実行結果が成功か失敗か（true / false）を返すようにしてください。

また、メソッド名は具体的かつ、ユーザが名前から挙動を推察できるようなものにしてください。例えば以下の例は抽象的すぎて駄目な命名です。

- doAction()
- execData()

## コードのコメント

コメントのフォーマットは[phpDocumentor](http://phpdoc.org/)に準拠して書いてください。

```php
/**
 * 関数のタイトル
 * 関数の簡略説明文
 * @propary 型 変数名 説明
 * @return 型
 */
function hoge($hoge) {
}
```

これらは特定のIDEなどの開発環境化において大きな助けになるでしょう。

### コメントの書き方

コメントには、単なるコードの挙動を説明するのではなく、なぜこういったコードを書くに至ったかの背景・ストーリーを簡単に記述してください。特に仕様変更された際に、なぜコードを変更したのかを後日見返して分かるようにすることが重要です。

また、コードを読めば自明なことはコメントする必要はありません。例えば以下の様なものです。

```php
// $hogeがtrueならdo()する
if ($hoge === true) {
	do();
}
```

余計なコメントはコードを読む上でストレスになりますし、コードの挙動が変わった際に、コメントとコードが同期されなくなる可能性もあります。

ただし、処理のかたまりを作るために、コメントで区切り（目安）をつけることは、コードリーディングの助けになります。

### コメント記法

特定のIDEでは、コメント記法によって抜き出すことが出来ます。

|記法|意味|
| ---- | ---- |
|TODO : |後で手を付ける|
|FIXME : | なにか問題があるコード|

### コメントのポイント

自分以外の誰かがコードを読んだ時に、意図が伝わるようにしましょう。

## PHPタグ

常にショートタグ(<? ?>)の代わりに、ロングタグ(<?php ?>)を使ってください。

## 命名規則

### 関数

全ての関数はキャメルバックで書いてください。

```php
function longFunctionName() {
}
```

### クラス

クラス名はキャメルケースで書かれる必要があります。

```php
class ExampleClass {
}
```

### 変数

変数名はできる限り説明的に、しかしできる限り短くもしてください。 通常の変数は小文字で始まり、複数の単語の場合はキャメルバックで書く必要があります。 オブジェクトを含む変数は大文字で始まり、何らかの方法で変数がオブジェクトとなっているクラスに関連したものになるべきです。

```php
$user = 'John';
$users = array('John', 'Hans', 'Arne');

$Dispatcher = new Dispatcher();
```

### メンバのアクセス権

メソッドと変数の為の、PHP5のprivateとprotectedキーワードを使用してください。 加えて、protectedなメソッドまたは変数の名前は単一のアンダースコア(“_”)から始まります。

```php
class A {
    protected $_iAmAProtectedVariable;

    protected function _iAmAProtectedMethod() {
       /*...*/
    }
}
```

privateなメソッドまたは変数の名前は二つののアンダースコア(“__”)から始まります。

```php
class A {
    private $__iAmAPrivateVariable;

    private function __iAmAPrivateMethod() {
        /*...*/
    }
}
```

privateなメソッドまたは変数を回避し、protectedなそれらを用いることを試してみて下さい。 後者はサブクラスからアクセスや修正が可能です。一方で、privateでは拡張や再利用ができません。 privateは、テストの実施もより難しくなります。

## 変数の型

ドキュメントブロックの中で使う変数の型

|型|説明|
| ---- | ---- |
|mixed|未定義(または複数)の型の変数。|
|integer|Integer型の変数(整数)。|
|float|Float型(小数点数)。|
|boolean|論理型(trueまたはfalse)。|
|string|文字列型(“”か’ ‘に入る値)。|
|array|配列型。|
|object|オブジェクト型。|
|resource|リソース型(例えばmysql_connect()による返り値)。 型をmixedに指定する場合、不明(unknown)なのか、取りうる型が何なのかを指し示すべきということを覚えていてください。|

## 定数

定数は大文字で定義する必要があります。もし定数の名前が複数の単語でできている場合は、アンダースコア文字によって分割する必要があります。

```php
define('CONSTANT', 1);
define('LONG_NAMED_CONSTANT', 2);
```





